<!DOCTYPE html>
<html class="writer-html5" lang="es" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.18.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Primeros pasos &mdash; documentación de urbantrips - 0.2.0</title>
      <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script src="_static/jquery.js"></script>
        <script src="_static/_sphinx_javascript_frameworks_compat.js"></script>
        <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
        <script src="_static/doctools.js"></script>
        <script src="_static/sphinx_highlight.js"></script>
        <script src="_static/translations.js"></script>
    <script src="_static/js/theme.js"></script>
    <link rel="index" title="Índice" href="genindex.html" />
    <link rel="search" title="Búsqueda" href="search.html" />
    <link rel="next" title="Input de datos" href="inputs.html" />
    <link rel="prev" title="Instalación" href="instalacion.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="index.html" class="icon icon-home">
            urbantrips
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Buscar documentos" aria-label="Buscar documentos" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="instalacion.html">Instalación</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Primeros pasos</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#datos-insumo">Datos insumo</a></li>
<li class="toctree-l2"><a class="reference internal" href="#archivo-de-configuracion">Archivo de configuración</a></li>
<li class="toctree-l2"><a class="reference internal" href="#estructura-de-directorios">Estructura de directorios</a></li>
<li class="toctree-l2"><a class="reference internal" href="#correr-urbantrips">Correr Urbantrips</a></li>
<li class="toctree-l2"><a class="reference internal" href="#resultados-finales">Resultados finales</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="inputs.html">Input de datos</a></li>
<li class="toctree-l1"><a class="reference internal" href="configuracion.html">Seteo del archivo de configuración</a></li>
<li class="toctree-l1"><a class="reference internal" href="lineas_ramales.html">Sobre el concepto de lineas y ramales en UrbanTrips</a></li>
<li class="toctree-l1"><a class="reference internal" href="resultados.html">Resultados finales</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">urbantrips</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="index.html" class="icon icon-home" aria-label="Home"></a></li>
      <li class="breadcrumb-item active">Primeros pasos</li>
      <li class="wy-breadcrumbs-aside">
            <a href="_sources/primeros_pasos.rst.txt" rel="nofollow"> Ver código fuente de la página</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="primeros-pasos">
<h1>Primeros pasos<a class="headerlink" href="#primeros-pasos" title="Enlace permanente a este encabezado"></a></h1>
<p>Una vez creado el ambiente e instalada UrbanTrips es necesario organizar los datos que funcionarán como insumos del proceso y el archivo de configuración.</p>
<p><strong>Insumos necesarios y opcionales</strong></p>
<p>Urbantrips requiere sólo 2 insumos indispensables:
- Un archivo csv con las transacciones del sistema de pago con tarjeta
- Un archivo de configuración: <cite>configuraciones_generales.yaml</cite></p>
<p>El archivo csv con las transacciones debe tener los siguientes campos obligatorios (los nombres pueden ser diferentes y esto se configura en el archivo configuraciones_generales.yaml):
-       <cite>id_tarjeta_trx</cite>: un id único para cada tarjeta para cada día.
-       <cite>id_linea_trx</cite>: un id único para cada linea de transporte
-       <cite>fecha_trx</cite>: campo que indica la fecha de la transacción.
-       <cite>hora_trx</cite>: solo es obligatorio cuando el campo fecha incluye solo el día, sin información de la hora y minutos.
-       <cite>orden_trx</cite>: un entero secuencial que establezca el orden de transacciones para una misma tarjeta en el día y que se reinicie con cada viaje. Es obligatorio unicamente cuando el campo fecha incluye solo el día o el día y hora, sin información a nivel de minutos.
-       <cite>latitud_trx</cite>: Latitud de la transacción.
-       <cite>longitud_trx</cite>: Longitud de la transacción.</p>
<p>Al correr el proceso general de <cite>urbantrips</cite>, éste tomará el archivo de configuración que le dirá qué archivo csv contiene la información con los datos de las transacciones a utilizar en esta corrida. En el directorio de trabajo podrá haber diversos archivos con datos de diferentes días o periodos de tiempo (<cite>lunes.csv</cite>, <cite>martes.csv</cite> o <cite>enero.csv</cite>, <cite>febrero.csv</cite>). Cada uno será procesado en una corrida por vez. Qué archivo utilizar se configura en <cite>configuraciones_generales.yaml</cite> en el parámetro <cite>nombre_archivo_trx:</cite>. En ese mismo archivo se configuran otros parámetros, como así también las bases donde los resultados se irán guardando. Para más detalles sobre cómo utilizar este archivo de configuración consulte el apartado [Seteo del archivo de configuración](#seteo-del-archivo-de-configuracion).</p>
<p>Con sólo esos archivos podrá correr el proceso de imputación de destinos, construcción de matrices OD y elaboración de KPIs. Dicho eso, se obtendrán más resultados y con mayor precisión si se suman estos archivos opcionales:</p>
<ul class="simple">
<li><p>Tabla con información de las líneas y/o ramales de transporte público (nombre de fantasía, etc).</p></li>
<li><p>Cartografía de los recorridos de las líneasy/o ramales de transporte público</p></li>
<li><p>Cartografía de las zonificaciones con las unidades espaciales utilizadas para agregar datos para la matriz OD</p></li>
<li><p>Tabla de GPS con el posicionamiento de las unidades</p></li>
</ul>
<section id="datos-insumo">
<h2>Datos insumo<a class="headerlink" href="#datos-insumo" title="Enlace permanente a este encabezado"></a></h2>
<p>Con UrbanTrips se pueden procesar en una corrida la información de transacciones correspondientes a más de un día. Sin embargo, no se puede dividir un mismo día en dos corridas. Toda la información respecto de un día debe procesarse en la misma corrida. Si es demasiada información, conviene separarla en diversos archivos donde cada uno siempre tenga la totalidad de la información de los días a analizar (por ej. <cite>lunes.csv</cite>, <cite>martes.csv</cite> o <cite>semana1.csv</cite>, <cite>semana2.csv</cite> pero no <cite>lunes_a.csv</cite>, <cite>lunes_b.csv</cite>). Luego en otras corridas pueden procesarse otros días y la información se irá actualizando en las bases correspondientes.</p>
<p>puede descargar el [dataset de transacciones SUBE de AMBA](<a class="reference external" href="https://media.githubusercontent.com/media/EL-BID/Matriz-Origen-Destino-Transporte-Publico/main/data/transacciones.csv">https://media.githubusercontent.com/media/EL-BID/Matriz-Origen-Destino-Transporte-Publico/main/data/transacciones.csv</a>), guardarlo en <cite>data/data_ciudad/transacciones.csv</cite>. Este dataset no cuenta con un campo <cite>fecha</cite> con el formato <cite>dd/mm/aaaa</cite>, deberá agregar con una fecha cualquiera y utilizar las configuraciones especificadas más abajo. A su vez, se debe especificar un <cite>id_linea</cite> con el criterio ya explicado previamente. Para eso se puede tomar la información de lineas de [este archivo](<a class="reference external" href="https://github.com/EL-BID/Matriz-Origen-Destino-Transporte-Publico/blob/main/data/lineas_ramales.csv">https://github.com/EL-BID/Matriz-Origen-Destino-Transporte-Publico/blob/main/data/lineas_ramales.csv</a>) (que se puede utilizar para el parámetro <cite>nombre_archivo_informacion_lineas</cite>). En este archivo, cada <cite>id_ramal</cite> tiene un <cite>id_linea</cite> asignado, con esa información pueden construir el <cite>id_linea</cite> de la tabla transacciones.</p>
</section>
<section id="archivo-de-configuracion">
<h2>Archivo de configuración<a class="headerlink" href="#archivo-de-configuracion" title="Enlace permanente a este encabezado"></a></h2>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">geolocalizar_trx</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">False</span>
<span class="nt">resolucion_h3</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">8</span>

<span class="c1">#tolerancia parada destino en metros</span>
<span class="nt">tolerancia_parada_destino</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">2200</span>

<span class="nt">nombre_archivo_trx</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">transacciones.csv</span>

<span class="nt">alias_db_data</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">amba</span>

<span class="nt">alias_db_insumos</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">amba</span>

<span class="nt">lineas_contienen_ramales</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">True</span>
<span class="nt">nombre_archivo_informacion_lineas</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">lineas_amba.csv</span>

<span class="nt">imputar_destinos_min_distancia</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">True</span>

<span class="c1">#ingresar el nombre de las variables</span>
<span class="nt">nombres_variables_trx</span><span class="p">:</span>
<span class="w">   </span><span class="nt">id_trx</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">id</span>
<span class="w">   </span><span class="nt">fecha_trx</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">fecha</span>
<span class="w">   </span><span class="nt">id_tarjeta_trx</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">id_tarjeta</span>
<span class="w">   </span><span class="nt">modo_trx</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">modo</span>
<span class="w">   </span><span class="nt">hora_trx</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">hora</span>
<span class="w">   </span><span class="nt">id_linea_trx</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">id_linea</span>
<span class="w">   </span><span class="nt">id_ramal_trx</span><span class="p">:</span><span class="w">  </span><span class="l l-Scalar l-Scalar-Plain">id_ramal</span>
<span class="w">   </span><span class="nt">interno_trx</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">interno_bus</span>
<span class="w">   </span><span class="nt">orden_trx</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">etapa_red_sube</span>
<span class="w">   </span><span class="nt">latitud_trx</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">lat</span>
<span class="w">   </span><span class="nt">longitud_trx</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">lon</span>
<span class="w">   </span><span class="nt">factor_expansion</span><span class="p">:</span>

<span class="nt">modos</span><span class="p">:</span>
<span class="w">   </span><span class="nt">autobus</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">COL</span>
<span class="w">   </span><span class="nt">tren</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">TRE</span>
<span class="w">   </span><span class="nt">metro</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">SUB</span>
<span class="w">   </span><span class="nt">tranvia</span><span class="p">:</span>
<span class="w">   </span><span class="nt">brt</span><span class="p">:</span>

<span class="nt">recorridos_geojson</span><span class="p">:</span>

<span class="c1"># Filtro de coordenadas en formato minx, miny, maxx, maxy</span>
<span class="nt">filtro_latlong_bbox</span><span class="p">:</span>
<span class="w">   </span><span class="nt">minx</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">-59.3</span>
<span class="w">   </span><span class="nt">miny</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">-35.5</span>
<span class="w">   </span><span class="nt">maxx</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">-57.5</span>
<span class="w">   </span><span class="nt">maxy</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">-34.0</span>


<span class="c1">#Especificar el formato fecha</span>
<span class="nt">formato_fecha</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;%d/%m/%Y&quot;</span>

<span class="nt">columna_hora</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">True</span>
<span class="nt">ordenamiento_transacciones</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">orden_trx</span>


<span class="nt">tipo_trx_invalidas</span><span class="p">:</span>
<span class="w">   </span><span class="nt">tipo_trx_tren</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&#39;CHECK</span><span class="nv"> </span><span class="s">OUT</span><span class="nv"> </span><span class="s">SIN</span><span class="nv"> </span><span class="s">CHECKIN&#39;</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&#39;CHECK</span><span class="nv"> </span><span class="s">OUT&#39;</span>
</pre></div>
</div>
</section>
<section id="estructura-de-directorios">
<h2>Estructura de directorios<a class="headerlink" href="#estructura-de-directorios" title="Enlace permanente a este encabezado"></a></h2>
<p>Al clonar UrbanTrips y correrlo, dejará la siguiente estructura de directorios:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>urbantrips
│   README.md
│
└─── urbantrips
│   ...
└─── configs
│   │   configuraciones_generales.yaml
│   │
└─── data
│   └─── db
│       │  amba_2023_semana1_data
│       │  amba_2023_semana2_data
│       │  amba_2023_insumos
│
│   └─── data_ciudad
│       │   semana1.csv
│       │   semana2.csv
│       │   lineas_amba.csv
│       │   hexs_amba.geojson
│       │   ...
└─── resultados
│   └─── data
│       │   amba_2023_semana1_etapas.csv
│       │   amba_2023_semana1_viajes.csv
│       │   amba_2023_semana1_usuarios.csv
│       │   amba_2023_semana2_etapas.csv
│       │   amba_2023_semana2_viajes.csv
│       │   amba_2023_semana2_usuarios.csv
│   └─── html
│       │   ...
│   └─── matrices
│       │   ...
│   └─── pdf
│       │   ...
│   └─── png
│       │   ...
│   └─── tablas
</pre></div>
</div>
</section>
<section id="correr-urbantrips">
<h2>Correr Urbantrips<a class="headerlink" href="#correr-urbantrips" title="Enlace permanente a este encabezado"></a></h2>
<p>Una vez que se dispone del archivo de transacciones y el de información de las líneas, es posible comenzar a utilizar <cite>urbantrips</cite>. En primer lugar es necesario inicializar los directorios y la base de datos que la librería necesita. Este paso solo se corre una vez.</p>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span>$<span class="w"> </span>python<span class="w"> </span>urbantrips/initialize_environment.py
</pre></div>
</div>
<p>Luego, se puede procesar la información de transacciones. Este archivo de transacciones puede tener la información de un día, una semana o un mes (siempre que no sea demasiada información). Este paso procesa las transacciones en etapas y viajes, imputando destinos. Luego pueden correr este paso por cada nuevo dataset que quieran procesar (<cite>semana_1.csv</cite>,`semana_2.csv`, etc) ajustando lo necesario en el archivo <cite>configuraciones_generales.yaml</cite>.</p>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span>$<span class="w"> </span>python<span class="w"> </span>urbantrips/process_transactions.py
</pre></div>
</div>
<p>Por último, una vez procesadas todas las transacciones que sean de interés y cargadas en la base de datos de la libería, es posible correr los pasos de post procesamiento sobre esa información, como los KPI, visualizaciones y exportación de resultados.</p>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span>$<span class="w"> </span>python<span class="w"> </span>urbantrips/run_postprocessing.py
</pre></div>
</div>
</section>
<section id="resultados-finales">
<h2>Resultados finales<a class="headerlink" href="#resultados-finales" title="Enlace permanente a este encabezado"></a></h2>
<p>Una vez procesados los datos, los resultados de urbantrips se guardarán en una base de datos <cite>SQLite</cite>.</p>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Pie de página">
        <a href="instalacion.html" class="btn btn-neutral float-left" title="Instalación" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Anterior</a>
        <a href="inputs.html" class="btn btn-neutral float-right" title="Input de datos" accesskey="n" rel="next">Siguiente <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Derechos de autor 2023, Felipe Gonzalez &amp; Sebastian Anapolsky.</p>
  </div>

  Compilado con <a href="https://www.sphinx-doc.org/">Sphinx</a> usando un
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">tema</a>
    proporcionado por <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>